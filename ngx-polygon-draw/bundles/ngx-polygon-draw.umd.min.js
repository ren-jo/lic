!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core")):"function"==typeof define&&define.amd?define("ngx-polygon-draw",["exports","@angular/core"],e):e(t["ngx-polygon-draw"]={},t.ng.core)}(this,function(t,e){"use strict";var r=function(){function t(){}return t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),i=function(){function c(t){this.rd=t,this.created=new e.EventEmitter,this.perimeter=[],this.complete=!1}return c.line_intersects=function(t,e,r,i){var n,o,s,c,h,a;return n=e.x-t.x,o=e.y-t.y,s=i.x-r.x,c=i.y-r.y,h=(-o*(t.x-r.x)+n*(t.y-r.y))/(-s*o+n*c),a=(s*(t.y-r.y)-c*(t.x-r.x))/(-s*o+n*c),0<=h&&h<=1&&0<=a&&a<=1},c.prototype.point=function(t,e){this.ctx.fillStyle="white",this.ctx.strokeStyle="white",this.ctx.fillRect(t-2,e-2,4,4),this.ctx.moveTo(t,e)},c.prototype.undo=function(){this.ctx=undefined,this.perimeter.pop(),this.complete=!1,this.start(!0)},c.prototype.clear_canvas=function(){this.ctx=undefined,this.perimeter=[],this.complete=!1,this.start(!1)},c.prototype.draw=function(t){this.ctx.lineWidth=1,this.ctx.strokeStyle="white",this.ctx.lineCap="square",this.ctx.beginPath();for(var e=0;e<this.perimeter.length;e++)0==e?this.ctx.moveTo(this.perimeter[e].x,this.perimeter[e].y):this.ctx.lineTo(this.perimeter[e].x,this.perimeter[e].y),t||this.point(this.perimeter[e].x,this.perimeter[e].y);t&&(this.ctx.lineTo(this.perimeter[0].x,this.perimeter[0].y),this.ctx.closePath(),this.ctx.fillStyle="rgba(255, 0, 0, 0.5)",this.ctx.fill(),this.ctx.strokeStyle="blue",this.complete=!0,this.created.emit(this.perimeter)),this.ctx.stroke(),this.perimeter.length},c.prototype.check_intersect=function(t,e){if(this.perimeter.length<4)return!1;var r=[],i=[],n=[],o=[];n.x=this.perimeter[this.perimeter.length-1].x,n.y=this.perimeter[this.perimeter.length-1].y,o.x=t,o.y=e;for(var s=0;s<this.perimeter.length-1;s++)if(r.x=this.perimeter[s].x,r.y=this.perimeter[s].y,i.x=this.perimeter[s+1].x,i.y=this.perimeter[s+1].y,!(i.x==n.x&&i.y==n.y||r.x==o.x&&r.y==o.y||1!=c.line_intersects(r,i,n,o)))return!0;return!1},c.prototype.point_it=function(t){return this.complete?(this.created.emit("already created"),!1):t.ctrlKey||3===t.which||2===t.button?2==this.perimeter.length?(this.created.emit("at least 3 points required"),!1):(r=this.perimeter[0].x,i=this.perimeter[0].y,this.check_intersect(r,i)?this.created.emit("line intersecrion"):(this.draw(!0),t.preventDefault()),!1):(e=this.canvas.getBoundingClientRect(),r=t.clientX-e.left,i=t.clientY-e.top,0<this.perimeter.length&&r==this.perimeter[this.perimeter.length-1].x&&i==this.perimeter[this.perimeter.length-1].y||(this.check_intersect(r,i)?this.created.emit("line intersection"):(this.perimeter.push({x:r,y:i}),this.draw(!1))),!1);var e,r,i},c.prototype.start=function(t){var e=this,r=new Image;r.src=this.src,r.onload=function(){e.ctx=e.canvas.getContext("2d"),e.ctx.drawImage(r,0,0,e.canvas.width,e.canvas.height),1==t&&e.draw(!1)}},c.prototype.ngOnInit=function(){this.setBcg(),this.start(!1)},c.prototype.setBcg=function(){var t=this;this.canvas=this.rd.selectRootElement(this.polygon.nativeElement),this.ctx=this.canvas.getContext("2d");var e=new Image;e.src=this.src,e.onload=function(){t.ctx.drawImage(e,0,0)}},c.decorators=[{type:e.Component,args:[{selector:"Ngx-NgxPolygonDraw",template:'\n    <div (load)="clear_canvas()">\n      <canvas #polygon id="jPolygon" width="640" height="480" style="cursor:crosshair" (mousedown)="point_it($event)" oncontextmenu="return false;">\n        Your browser does not support the HTML5 canvas tag.\n      </canvas>\n    </div>\n  '}]}],c.ctorParameters=function(){return[{type:e.Renderer2}]},c.propDecorators={src:[{type:e.Input}],created:[{type:e.Output}],polygon:[{type:e.ViewChild,args:["polygon"]}]},c}(),n=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[i],imports:[],exports:[i]}]}],t}();t.NgxPolygonDrawService=r,t.NgxPolygonDrawComponent=i,t.NgxPolygonDrawModule=n,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-polygon-draw.umd.min.js.map